"use strict";angular.module("clashApp",["ngCookies","ngResource","ngSanitize","ngRoute","ngTouch","ngAnimate"]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"}),b.html5Mode(!0)}]),angular.module("clashApp").factory("Squad",["Tank","Spear","Healer","Archer","Dead","$timeout",function(a,b,c,d,e,f){function g(a,b){this.w=b,this.h=a,this.list=[],this.init()}var h=[a,b,c,d];return g.prototype.init=function(){if(this.w&&this.h)for(var a=0;a<this.w*this.h;a++){var b=this.getANewSoldier(),c=this.iToPo(a);b.x=c.x,b.y=c.y,this.list[a]=b}},g.prototype.iToPo=function(a){var b=a%this.h,c=(a-b)/this.h;return{x:b,y:c}},g.prototype.poToI=function(a,b){return b*this.h+a},g.prototype.getANewSoldier=function(){h.length<=0&&(h=[a,b,c,d]);var e=h.splice(Math.floor(Math.random()*h.length),1),f=new e[0];return f},g.prototype.getSoldierByPos=function(a,b){if(0>a||0>b)return null;var c=this.poToI(a,b),d=this.list[c];return d||null},g.prototype.setSoldierByPos=function(a,b,c){if(0>a||0>b||a>this.h-1||b>this.w-1)return!1;var d=this.poToI(a,b);return this.list[d]?(c.x=a,c.y=b,this.list[d]=c,!0):!1},g.prototype.getMatrix=function(){return this.list},g.prototype.swap=function(a,b,c){function d(a,b){a.x>3||b.x>3;var c=Math.abs(a.x-b.x),d=Math.abs(a.y-b.y);return 1!==c&&1!==d||c+d!==1?!1:b instanceof e&&b.x>a.x||a instanceof e&&a.x>b.x?!1:!0}if(d(a,b)){var g=this.list,h=this.poToI(a.x,a.y),i=this.poToI(b.x,b.y);if(g[h]=b,g[i]=a,c)f(function(){var c=a.x,d=a.y;a.x=b.x,a.y=b.y,b.x=c,b.y=d},100);else{var j=a.x,k=a.y;a.x=b.x,a.y=b.y,b.x=j,b.y=k}return!0}return!1},g}]),angular.module("clashApp").controller("MainCtrl",["$scope","Squad","Dead","Spear","Healer","Tank","Archer","$timeout",function(a,b,c,d,e,f,g,h){var i=new Audio("sounds/clash.mp3"),j=new Audio("sounds/clash2.mp3"),k=new Audio("sounds/clash3.mp3"),l=new Audio("sounds/clash4.mp3"),m=[i,j,k,l],n=new Audio("sounds/click.mp3"),o=[],p=null,q=null,r=[],s=7,t=4,u=0,v=new b(t,s),w=new b(t,s),x="clashHightScore4",y="clashGuideViewed",z=parseInt(localStorage[y]||0),A=s*t;a.gameOver=!1,a.turn=0,a.movesLeft=10,a.MAXMOVESLEFT=a.movesLeft;var B=0,C=[],D=parseInt(localStorage[x]||0);a.enemyMatrix=[],a.matrix=[],a.demoMatrix=[],h(function(){var c=new b(2,6);a.demoMatrix=c.getMatrix()},500),h(function(){o=new Array(a.MAXMOVESLEFT),a.enemyMatrix=v.getMatrix(),a.matrix=w.getMatrix()},500);var E=0;a.currentGuide=z?-1:0,a.MAXGUIDES=4,a.guideFlags=new Array(a.MAXGUIDES),a.resetGame=function(){n.play(),p=null,q=null,r=[],v=new b(t,s),w=new b(t,s),A=s*t,a.gameOver=!1,a.turn=0,a.movesLeft=10,a.MAXMOVESLEFT=a.movesLeft,u=0,B=0,C=[],o=new Array(a.MAXMOVESLEFT),a.enemyMatrix=v.getMatrix(),a.matrix=w.getMatrix(),E=0},a.displayClass={guideAnimation:function(b){return 0===b?a.guideFlags[0]?"hideleft":"":void 0},selected:function(a){return a===p?"selected":""},highlighted:function(a){return-1!==r.indexOf(a)?"highlighted":""},clashAnimation:function(b){return a.clashAnimationOn?"up"===b?"bendup":"left"===b?"hideleft":"benddown":""},deathAnimation:function(a){return a.health<=0&&a instanceof c!=!0?"killed":""},getGemClass:function(b){return b>=a.movesLeft?"gem-empty":"gem-full"}},a.moveNext=function(b){"undefined"==typeof b?a.currentGuide++:0===b&&(a.guideFlags[0]=1,h(function(){a.currentGuide++},1e3)),a.currentGuide>=a.MAXGUIDES&&(a.currentGuide=-1,localStorage[y]=1,a.resetGame())},a.clearRangesHighlight=function(){r=[]},a.showInRanges=function(a,b){var c,d,f=b.x,g=b.y;if(a?(c=w,d=v):(c=v,d=w),b instanceof e){var h=c.getSoldierByPos(f-1,g),i=c.getSoldierByPos(f+1,g),j=c.getSoldierByPos(f,g-1),k=c.getSoldierByPos(f,g+1);h&&r.push(h),i&&r.push(i),j&&r.push(j),k&&r.push(k)}else{var l=d.getSoldierByPos(b.attackRange-1-f,g);l&&r.push(l)}},a.getAbsPos=function(a,b){var c={},d=100;return c["-webkit-transform"]=a?"translateY("+-60*b.x+"px)":"translateY("+60*b.x+"px)",c.left=60*b.y+d+"px",c.transform=c["-webkit-transform"],c},a.awesomeThings=[w.w,"AngularJS","Karma"],a.runClashAnimation=function(){a.clashAnimationOn=!0,h(function(){a.clashAnimationOn=!1},1500)},a.getScore=function(){return u},a.getKilled=function(){return E},a.getGems=function(){return o},a.getCombos=function(){return a.gameOver?C:[]},a.updateScore=function(){u++,B++,E++,h(function(){u>D&&(D=u,localStorage[x]=u)})},a.getHighScore=function(){return D},a.playSound=function(){0===m.length&&(m=[i,j,k,l]);var a=m.splice(Math.floor(Math.random()*m.length),1)[0];a.play()},a.clash=function(){function b(a){function b(b){if(b&&!(b instanceof c)){var e=b.x,f=b.y,g=a.getSoldierByPos(e-1,f),h=a.getSoldierByPos(e+1,f),i=a.getSoldierByPos(e,f-1),j=a.getSoldierByPos(e,f+1);g&&d(g),h&&d(h),i&&d(i),j&&d(j)}}function d(a){var b=a.health+1;a.health=Math.min(b,a.MAXHEALTH)}for(var f=0;f<a.h;f++)for(var g=0;g<a.w;g++){var h=a.getSoldierByPos(f,g);h&&h instanceof e&&b(h,a)}}function d(){function b(a,b){if(a&&!(a instanceof c)){var d;d=b?v:w;var e=d.getSoldierByPos(a.attackRange-1-a.x,a.y);e&&e instanceof c!=!0&&(e.health-=a.attack)}}for(var d=(a.matrix,a.enemyMatrix,0);2>d;d++)for(var e=0;s>e;e++){var f=w.getSoldierByPos(d,e),g=v.getSoldierByPos(d,e);b(f,1),b(g,0)}}function f(a){for(var b=0;b<a.h;b++)for(var d=0;d<a.w;d++){var e=a.getSoldierByPos(b,d);if(e&&e instanceof c){var f=a.getANewSoldier();a.setSoldierByPos(b,d,f)}}}function g(b,d){for(var e=0;e<b.h;e++)for(var f=0;f<b.w;f++){var g=b.getSoldierByPos(e,f),h=b.getSoldierByPos(e+1,f);if(g&&g.health<1&&g instanceof c!=!0){d?(A--,0>=A&&(a.gameOver=!0)):a.updateScore();var g=new c;b.setSoldierByPos(e,f,g)}g&&g instanceof c&&h&&h instanceof c!=!0&&b.swap(g,h)}}n.play(),p=null,q=null,a.runClashAnimation(),h(function(){b(w),b(v),a.playSound()},900),h(function(){d()},1200),h(function(){g(w,1),g(v,0),g(w,1),g(v,0),f(v),B&&(void 0===C[B]?C[B]=1:C[B]++),u+=parseInt(Math.pow(3.3,B)-1),B=0},1500),a.turn++,a.movesLeft=10},a.reportPos=function(a){n.play()},a.go=function(b){n.play(),a.movesLeft>0&&(p?p===b?p=null:q=b:p=b,q&&(w.swap(p,q,1)?(p=null,q=null,1===a.currentGuide?h(function(){a.moveNext()},1e3):a.movesLeft--):(p=q,q=null)))}}]),angular.module("clashApp").factory("Soldier",function(){function a(){this.moved=!1,this.x,this.y,this.id="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})}return a.prototype.attack=function(){this.moved=!0},a.prototype.swap=function(){this.moved=!0},a}).directive("myDirective2",function(){return{compile:function(a){a.html("<script>{{extraScript}}</script>")}}}).directive("myDirective",function(){return{template:'<input ng-model="foo">{{extraScript}}'}}),angular.module("clashApp").factory("Tank",["Soldier",function(a){function b(){a.call(this),this.className="tank",this.health=8,this.MAXHEALTH=this.health,this.attackRange=1,this.attack=2}return b.prototype=new a,b}]),angular.module("clashApp").factory("Archer",["Soldier",function(a){function b(){a.call(this),this.className="archer",this.health=2,this.MAXHEALTH=this.health,this.attackRange=2,this.attack=4}return b.prototype=new a,b}]),angular.module("clashApp").factory("Healer",["Soldier",function(a){function b(){a.call(this),this.className="healer",this.health=3,this.MAXHEALTH=this.health,this.attackRange=1,this.attack=2}return b.prototype=new a,b}]),angular.module("clashApp").factory("Spear",["Soldier",function(a){function b(){a.call(this),this.className="spear",this.health=4,this.MAXHEALTH=this.health,this.attackRange=1,this.attack=3}return b.prototype=new a,b}]),angular.module("clashApp").factory("Dead",["Soldier",function(a){function b(){a.call(this),this.className="dead",this.health=0,this.MAXHEALTH=this.health,this.attackRange=0,this.attack=0}return b.prototype=new a,b}]);